![[_resources/T3-DNS-ssh-ftp.pdf]]

#dns #tld #nameservers #registro

---
# 1. Nombrado

## DNS
*Problema:* convertir nombres de máquinas en IPs
*Solución inicial:* un archivo `hosts.txt`.

> [!warning] Problemas
> - Actualización y distribución manual.
> - Colisiones de nombres.
> - Consistencia.

> [!success] Solución
> Sistema de nombres jerárquico.
> Base de datos distribuida → DNS.

### Arquitectura básica
La arquitectura es cliente/servidor:
- Clientes → *resolvers*
- Servidores → *nameservers*

- [Espacio de nombres](#Espacio de nombres) jerárquico, se representa en un árbol.
- Base de datos distribuida entre muchos servidores.
- Protocolos para cliente/servidor o entre servidores.
### Espacio de nombres

#### Dominios de nivel superior

### Base de datos
<mark style="background: #ADCCFFA6;">Un nombre de dominio es el índice de la BD.</mark>

El contenido de la BD para cada índice es un *Resource Record* (RR) con información como:
- si es un nodo final (host) o una sub-zona.
- si ese nodo es un servidor de nombres.
- la IP de la máquina (← el objetivo principal)
- otros nombres para la máquina (y su nombre canónico).
- la persona de contacto (ICANN WHOIS)
- ...

### Implementación
DNS es una especificaicón, puede haber diferentes implementaciones. La más usada es `BIND` (*Berkeley Internet Name Domain*)

En la implementación de `BIND` se tienen:
- <mark style="background: #BBFABBA6;">Servidores de nombres</mark> (`named`) ← complejos
- <mark style="background: #FFB86CA6;">Clientes</mark> *resolver*, muy simples. No son un proceso sino una biblioteca que implementan `gethostbyname()`.

### <mark style="background: #BBFABBA6;">Servidor de nombres</mark>
<mark style="background: #ADCCFFA6;">Programa que tiene información completa sobre una zona de la que tiene <u>autoridad</u>. Sus respuestas son definitivas.
</mark>
Al delegar parte de la zona:
- El <mark style="background: #BBFABBA6;">SN</mark> original borra la información referente a la nueva sub-zona.
- El <mark style="background: #BBFABBA6;">SN</mark> de la nueva zona es la nueva autoridad en ella.

Una zona puede tener varios <mark style="background: #BBFABBA6;">NS</mark> → redundancia, seguridad y balanceo de carga.
- *Primario:* obtiene los datos de un fichero local.
- *Secundario:* obtiene los datos de un <mark style="background: #BBFABBA6;">NS</mark> primario.
La única diferencia es el origen de los datos. Ambos pueden ser la *autoridad*.

### <mark style="background: #FFB86CA6;">Resolvers</mark>
<mark style="background: #ADCCFFA6;">Cliente que consulta el servidor de nombres. Su misión es:</mark>
- A petición de un programa, conecta con el <mark style="background: #BBFABBA6;">SN</mark> y hace una consulta.
- Interpreta la respuesta y hace más consultas si es necesario.
- Devuelve la información solicitada.

### Resolución
<mark style="background: #ADCCFFA6;">Proceso por el cual se llega a una respuesta (se encuentra la IP / el nombre no existe).</mark>

> [!info]
> Ya que cada <mark style="background: #BBFABBA6;">NS</mark> almacena solo parte de la BD distribuida, una consulta puede no encontrar la respuesta. Dos alternativas:
> 1. El <mark style="background: #BBFABBA6;">NS</mark> contacta con otros servidores hasta encontrar la respuesta (**consulta recursiva**)
> 2. El <mark style="background: #BBFABBA6;">NS</mark> retorna una referencia a otros servidores para proseguir la resolución (**consulta iterativa**)

### Implementación (en BIND)
La conuslta del <mark style="background: #FFB86CA6;">resolver</mark> siempre es de tipo **recursivo**.
- Se simplifica el código del <mark style="background: #FFB86CA6;">resolver</mark> (es una mera biblioteca)

El <mark style="background: #BBFABBA6;">NS</mark> retorna la respuesta si la tiene, de lo contrario usa una consulta de tipo *iterativo* para hallarla.

### Resolución inversa
- Se define un dominio especial `in-addr.arpa`
- Este dominio tiene NS como cualquier otro dominio.
- El dominio puede estar dividido en zonas delegadas, como cualquier otro dominio.
 > [!info] La idea principal es convertir las IPs en nombres
 > Los nombres de los subdominios de `in-addr.arpa` son números entre $1$ y $255$, que se subdividen en subdominios con nombres numéricos también (ej: `105.33.35.156.in-addr.arpa`)
 
 ### Cacheado
 Cada <mark style="background: #BBFABBA6;">NS</mark> puede mantener una cache con:
 - Las respuestas que ha servido (incluso las negativas)
 - Las IPs de los <mark style="background: #BBFABBA6;">NS</mark> de otras zonas
Esto evita que tenga que acudir cada vez a los <mark style="background: #BBFABBA6;">NS-Raíz</mark>.

- La caché debe descartarse pasado un cierto timepo, de lo contrario los cambios nunca se propagarían.
- **TTL:** parámetro fijado por el admin de la zona.

# 2. Acceso remoto
