![[_resources/Tema 1. Introducción. Servicios básicos.pdf]]

---

**Capas**
![[_resources/Pasted image 20230912173301.png]]

> [!faq] Pregunta posible de examen
> Una petición no es válida si contiene caracteres no ASCII puro como tildes u otros símbolos.
> Para corregir una cadena, se debe utilizar `urllib.parse.quote(petition)`.


```python
# Intento (mal) de pedir geolocalización de una calle
host = "us1.locationiq.org" 
calle = "Campus de Viesques, Gijón" 

peticion = "GET " 
peticion += "/v1/search.php?key=pk.dc05..." 
peticion += "&format=json&q=" + calle 
peticion += " HTTP/1.1\r\n" 
peticion += "Host: " + host + "\r\n\r\n" 

import socket 
s = socket.socket() 
s.settimeout(2) 
s.connect((host, 80)) 
a_enviar = peticion.encode("utf8") 
s.send(a_enviar) 
respuesta = s.recv(32000) 
print(respuesta.decode("utf8"))

# Petición HTTP inválida
```

# Servicios
> [!info] Definición
> Protocolo que nos da la capa de aplicación que sirve para implementar aplicaciones.
> - Implementado por TCP/UDP.
> - Define e implementa su propio protocolo (generalmente estandarziado en un RFC)
> - El servicio puede ser usado tanto por el usuario final como por otros servicios.

## DHCP
Cuatro fases: **D**iscovery, **O**ffer, **R**equest, **A**cknowledgement.

- **Discovery:** el cliente usa un broadcast UDP al puerto 67 para descubrir un servidor.
	- En el datagrama puede especificar qué IP prefiere.
	- Queda a la espera de respuestas en el puerto UDP 68.
- **Offer:** el servidor envía una oferta al cliente conteniendo la IP elegida.
	- Maneja un pool de IPs e información de configuración (DNS, rotuer de salida...)
- **Request:** el cliente se queda con una de las ofertas que recibe.
	- Si no recibe respuestas, puede reintentar el paso 1.
	- Puede recibir varias ofertas, cada una con el identificador del servidor que la hizo.
	- El cliente elige UNA, crea un datagrama de solicitud que contiene el id del servidor que hizo la oferta elegida y envía por *broadcast* el datagrama.
- **Acknowledgement:** el servidor envía un datagrama de reconocimiento al cliente, si el datagrama de solicitud era suyo, indicándole leasing e información de configuración.
	- Si el id no era el suyo, lo ignora y devuelve la IP ofrecida al pool.

Cuando una máquina se apaga, debería liberar su IP con el paquete *DHCP Release*, momento en el que el servidor IP devolverá su IP a la pool. Si no lo hace, se liberará cuando expire el tiempo de lease.


## NAT
Es la modificación de la IP de un paquete a su paso por un router. (incluyendo checksums y cabeceras).

