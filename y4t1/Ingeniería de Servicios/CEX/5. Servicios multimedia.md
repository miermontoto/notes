
[[_resources/Tema 5_ Servicios Multimedia.pdf]]

---
# Introducción
Dos tipos:
- No interactivos
	- El usuario consume el servicio sin interactuar con él
	- Desde el punto de vista de la ingeniería de servicios, es un problema de transmisión de archivos.
	- Problemas nuevos: streaming, sincronización, formatos, códecs...
- Interactivos
	- El usuario interactúa con otro usuario, mediante contenido multimedia, generalmente en tiempo real.
	- Ejemplo: VoIP, videoconferencias...
	- Son necesarios nuevos protocolos (presencia, inicio de sesión, transporte...)

## Aspectos a estudiar
- Representación de la información multimedia
	- Imagen estática
	- Audio
	- Vídeo
- Compresión (códecs)
	- Guerra de códecs, estándares
- Contenedores
- Protocolos de transmisión

# Información multimedia
## Imagen
Dos formas de representación:
- **Mapa de bits** *PNG, JPG, TIFF, WEBP*
	- Array de puntos (*pixels*)
	- Cada pixel almacena un color usando *n* bits
	- El color se expresa por componentes RGB
- **Vectorial** *SVG*
	- Lista de objetos (primitivas) → círculo, recta, arco... con atributos (tamaño, color, origen, fondo, grosor...)
	- Independiente de la resolución

## Vídeo
Secuencia de frames → cada frame es un mapa de bits.

El tamaño depende de: 
- Tamaño de cada frame
- Número de frames por segundo
- La duración del vídeo

*bitrate → bits por segundo*. Depende de:
- Tamaño de cada frame
- El frame rate

### Compresión
- Intra-frame *ej. JPEG*
	- Cada frame se comprime por separado
	- Explota la redundancia espacial en cada frame
- Inter-frame
	- Existe también redundancia temporal
	- Tener en cuenta los frames seguidos
	- Se pueden codificar solo las diferencias entre frames

**Tipos de frame**
- I-frame (intra-coded): usa el mismo algoritmo de compresión que una imagen fija. No necesita otros frames para decodificarse.
- P-frame (predicted): codifica solo los cambios respecto al frame anterior.
- B-frame (bi-predictive): codifica los cambios con respecto al frame anterior y el siguiente → mayor compresión que el P-frame.

![[_resources/Pasted image 20231212171214.png]]

**Algoritmos de compresión**
> [!note] Irrelevante
> Cultura general

*antiguos*
- MPEG-1 Part 2 (VHS)
- MPEG-2 Part 2 (DVD, BluRay)
- MPEG-4 Part 2 (DivX, Xvid, Nero)
- Theora → OpenSource, basado en VP3
- VP6 (Adobe Flash y JavaFX)

*modernos*
- MPEG-4 Part 10 (AVC) → H.264
- VP8 → WebM
- HEVC → sucesor de MPEG-4, estandarizado como H.265
- VP9 → sucesor de VP8, mejora su compresión
- AV1 → incorpora VP10, *state of the art, royaltie-free* ES EL FUTURO 

## Audio
- Periodo de muestreo
	- El doble de la frecuencia más alta que se quiera retener
	- El oído humano capta hasta 20KHz
	- El estandar actual es 44.1KHz
- Bits de resolución
	- Cuantos más bits, mayor fidelidad pero mayor tamaño
	- Valor típico: 16 bits

> [!info] 44.1KHz + 16 bits = CD quality

**Bitrate y tamaño**
Al igual que en vídeo, existe el concepto de bitrate → bits por segundo.
Depende de:
- Frecuencia de muestreo
- Bits en cada muestra
- Número de canales (mono/estéreo)

**Compresión**
*sin comrpesión*
- PCM (wav, AIFF, CD)

*con compresión sin pérdida*
- FLAC
- APE
- WMA9 lossless
- ALAC

*con compresión con pérdida*
- MPEG-1 Audio Layer III (MP3)
- MPEG-2 Part 7 (AAC)
- WMA
- Vorbis (~AAC)
- MPEG-4 Part 3 (HE-AAC)
- Opus (sucesor de Vorbis)

## Contenedores digitales
Formato de archivo que contiene uno o varios *streams* de audio o vídeo y otros datos, junto con información sobre cómo sincronizarlos.

Pueden contener:
- Un stream de vídeo (sin sonido)
- Un stream de audio con la versión original del mismo
- Otro stream de audio con el doblaje a otro idioma
- Un stream de subtítulos

Cada stream de audio/vídeo requiere el códec apropiado para su descodificación. El contenedor es independiente de los códecs.

**Contenedores habituales**
- avi (audio video interface)
- flv (flash video)
- mkv (matrovska)
	- mp4 → m4a cuando es solo audio
- ogg
- mov (quicktime)
- webm

## Protocolos de transimisión
Los contenedores digitales (como cualquier otro archivo):
- Se puede usar un protocolo de transferencia de archivos
- Se descarga el archivo y se reproduce
- Se requiere un reproductor que entienda el formato contenedor.
- Se requieren códecs particulares usados para codificar audio y vídeo.
- No se puede iniciar la reproducción hasta tener el archivo completo
- El usuario puede pausar, rebobinar, avanzar, etc. pues son operaciones locales sobre el archivo descargado.
> [!note] HTTP es un caso particular


### Protocolos de streaming
Específicos para transmitir audio/vídeo:
- Transmiten los frames (comprimidos con algún códec)
- Y los canales de audio
- Incluyen datos para la sincronización de los diferentes streams
- Controlan la calidad de la conexión y se ajustan a ella
- La reproducción puede hacerse simultánea a la descarga
- La fuente de audio/vídeo no necesita ser un fichero en el servidor → puede ser contenido generado en tiempo real.
- El cliente no necesita almacenar el fichero.
- Se usan otros protocolos para controlar la reproducción a modo de "control remoto".

### El caso particular de HTTP
HTML originalmente no tenía previsto el contenido multimedia, por tanto no podia reproducirse nada en un navegador.

- A través de `<object>` se podían incrustar otros procesos (plugins) en la página mostrada por el navegador.
- Esto permitiría mostrar en la página audio/video.
- Pero el proceso que lo reproducía era de terceras partes (WMP, macromedia Flash, java applets, realplayer...)
- El protocolo usado por ese plugin era específico del mismo:
	- En muchos casos era un protocolo propietario
	- Distinto de HTTP
- El formato de vídeo/audio soportado era específico del plugin
	- En muchos casos era un formato propietario
	- Aunque con el tiempo todos soportaban H264
- El aspecto era controlado por el plugin y NO por el código de la página, puesto que no era parte de la misma.

#### HTML5
- Prevé los tags `<audio>` y `<video>`.
- Los navegadores que lo soportan son capaces de reproducir ellos mismos el audio y el vídeo sin necesidad de plugins.
- Esto elimina la necesidad de Flash, RealPlayer, etc.
- Apple ha sido un gran impulsor de HTML5 y la eliminación del Flash.
- No especifica los formatos y códecs soportados.

### Descarga progresiva
- Usa HTTP para descargar el archivo
- El cliente comienza la reproducción tan pronto como sea posible
	- Requiere un formato de contenedor con información apropiada en la cabecera
	- Requiere velocidad de descarga > velocidad de reproducción
- El cliente puede utilizar la cabecera `Range` para especificar el byte en el que comenzar la descarga
	- Permite avanzar a diferentes puntos del vídeo
	- El servidor debe indicar `Accept-Ranges` en su cabecera
- Es usado por todos los navegadores para el tag `<