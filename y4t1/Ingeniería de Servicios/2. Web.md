![[_resources/T2-Web.pdf]]
## Contenidos
1. Arquitectura básica
2. Sintaxis de los mensajes HTTP
3. Cabeceras HTTP
4. Proxies y cachés
5. Páginas generadas dinámicamente
6. Sesiones y cookies
7. Autenticación
---
# 1. Arquitectura básica de la web

# 2. Sintaxis de los mensajes HTTP

# 3. Cabeceras HTTP
- El nombre no puede contener espacios y suelen estar estandarizados.
- `<CRLF>` es una forma de representar la secuencia de bytes `\r\n`.
- Las cabeceras terminan cuando aparece una línea en blanco `<CRLF><CRLF>`.

## Tipos de cabeceras
- **Generales**
	- `Date`
	- `Connection` (`keep-alive`, `close`): decide si cerrar el stream TCP o no.
	- `Cache-control`: decide si se aceptan contenidos cacheados o no.
- **De petición** (solo en msgs de petición)
	- `Host` (*obligatorio*): incluye el nombre de dominio al que se envía la petición.
	- `User-Agent`
	- `Accept`: tipos MIME que el cliente acepta.
	- `Accept-Encoding`: tipos de codificación que el cliente acepta.
	- `If-None-Match`: optimización que permite al cliente no descargar algo que ya tiene
	- `Cookie`
	- `Authroization`
- **De respuesta** (solo en msgs de respuesta)
	- `Server`
	- `WWW-Authenticate`: especifica tipo de autenticación
	- `Set-Cookie`
	- `Transfer-Encoding` (`chunked`): método usado por el servidor para enviar el cuerpo
- **De entidad**: describen el cuerpo.
	- `Content-Type`
	- `Content-Length`
	- `Content-Language`
	- `Etag`: identificador del recurso para optimizaciones de caché.
- **De extensión**: ampliaciones y otros usos no estandarizados.

# 4. Proxies y cachés
## Proxies
> [!info] Definición
> Servidores intermediarios entre el cliente y otros servidores.


## Tipos de proxies
### Directo
Sirve peticiones dirigidas a otros servidores.
![[_resources/Pasted image 20231002155428.png]]
### Indirecto
Ante el cliente parece un servidor normal, pero obtiene el recurso de otros servidores.
![[_resources/Pasted image 20231002155414.png]]
## Caché
> [!info] Definición
> Almacén más cercano y rápido que contiene copias de recursos para no tener que pedirlas de nuevo.

- Reducen el uso de red.
- Reducen el tiempo necesario para obtener el recurso.

**Códigos de respuesta**
-  `304 Not Changed` (no se actualizó el contenido)
- `200 OK` (y envia una nueva copia)

### Estrategias (cabeceras)
Son diferentes estrategias para que el cliente sepa cuándo descargar un recurso otra vez.

#### Basado en la fecha de modificación
Se basa en la fecha del último cambio.
- El cliente solicita por primera vez un recurso.
- El servidor (tal vez) le devuelve en la cabecera `Last-Modified`
- El cliente almacena en su caché local el recurso, junto con esa fecha de última modificación.
- Cuando el cliente necesita el recurso de nuevo, usa el campo `If-Modified-Since` con la fecha guardada.

#### Basado en el cambio del contenido (etags)
Se basa en el contenido del recurso.

> [!info] ETag
> Es un hash del contenido del recurso.
> Si su recurso cambia, cambiará su ETag.

- Junto con el recurso, el servidor envía el hash en una cabecera `ETag`.
- El navegador almacena el hash junto al recurso.
- Cuando necesita de nuevo el recurso, usa la cabecera `If-None-Match` en la petición, con el valor del hash.

#### Basado en la fecha de caducidad (frescura)
Se basa en el tiempo estimado entre cambios.
- Junto con el recurso, el servidor envía un campo `Cache-control` donde especifica el tiempo de vida del recurso (`max-age`).
- El cliente no volverá a pedir el recurso hasta que expire el tiempo.

Esto evita el tráfico de 304 pero es un problema si el recurso cambia antes.

### Cache remota
- El cliente pide un recurso.
- Un proxy-caché intermedio gestiona la petición.
- Puede que el proxy devuelva una copia, en lugar de pedir el recurso.